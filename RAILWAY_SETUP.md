# Настройка проекта для Railway

## Оптимизации для быстрого билда

Проект оптимизирован для Railway с фокусом на скорость сборки и деплоя.

## Настройки Railway

### 1. Переменные окружения (Environment Variables)

В настройках Railway добавьте следующие переменные:

#### Обязательные:
```
NODE_ENV=production
PORT=3001
```

#### Опциональные (для оптимизации):
```
PUPPETEER_CACHE_DIR=/tmp/.cache/puppeteer
NPM_CONFIG_CACHE=/tmp/.npm
```

### 2. Настройки Build

Railway автоматически обнаружит `railway.json` и использует оптимизированные настройки:

- **Builder**: NIXPACKS (автоматически определяет Node.js)
- **Build Command**: `npm ci --prefer-offline --no-audit` (быстрая установка без аудита)
- **Start Command**: `npm start`

### 3. Рекомендуемые настройки Railway

#### Build Settings:
1. **Build Command**: Оставьте пустым (Railway использует `railway.json`)
2. **Start Command**: Оставьте пустым (Railway использует `railway.json`)

#### Resource Settings:
- **Memory**: Минимум 512MB (рекомендуется 1GB для Puppeteer)
- **CPU**: Стандартный план ($20/месяц)

#### Deployment Settings:
- **Auto Deploy**: Включено (автоматический деплой при push в main)
- **Branch**: `main` (или ваша основная ветка)

### 4. Оптимизации в проекте

#### Файлы конфигурации:
- `.railwayignore` - исключает ненужные файлы из деплоя
- `.npmrc` - оптимизирует установку npm пакетов
- `railway.json` - настройки билда и деплоя

#### Puppeteer оптимизации:
- Использует `--single-process` для Railway (меньше памяти)
- Отключены ненужные функции браузера
- Кэширование Chromium в `/tmp/.cache/puppeteer`

### 5. Мониторинг билда

Для отслеживания времени билда:
1. Перейдите в Railway Dashboard
2. Откройте ваш проект
3. Вкладка "Deployments" покажет время каждого билда

### 6. Устранение проблем

#### Медленный билд:
- Проверьте, что `.railwayignore` правильно исключает файлы
- Убедитесь, что `package-lock.json` закоммичен
- Проверьте размер репозитория (должен быть < 100MB без node_modules)

#### Ошибки Puppeteer:
- Убедитесь, что выделено достаточно памяти (минимум 512MB)
- Проверьте переменные окружения `PUPPETEER_CACHE_DIR`

#### Ошибки установки зависимостей:
- Проверьте `.npmrc` файл
- Убедитесь, что версии Node.js совместимы (>= 18.0.0)

## Ожидаемое время билда

После оптимизации:
- **Первая сборка**: 3-5 минут (скачивание Chromium)
- **Последующие сборки**: 1-2 минуты (с кэшем)

## Дополнительные оптимизации

### Использование Railway Build Cache:
Railway автоматически кэширует:
- `node_modules/` между билдами
- Chromium из Puppeteer (если `PUPPETEER_CACHE_DIR` установлен)

### Мониторинг:
- Используйте Railway Metrics для отслеживания использования ресурсов
- Настройте алерты при превышении лимитов

